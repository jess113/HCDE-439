<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />

    <title>Jesse Du's HCDE 439 Physical Computing Page!</title>

    <link href="style.css" media="screen" rel="stylesheet" type="text/css" />

</head>

<body>

    <div class="header">
        <h1>Jesse Du's Final Project!</h1>
        <p>
            My concept is to make a mouse for my laptop. By using the Mouse library it is possible to control the computer's cursor with an Arduino Leonardo and the joystick module. For better usability, I also want to be able to easily turn on and off mouse control without having to unplug the Arduino board.
        </p>
        <p>
            <img src="final/final_circuit.jpg" width=400></a>
        </p>
        <p>
            A joystick module connected to the Arduino board with Dupont wires (ground, 5V, VRx to pin A0, VRy to pin A1, and switch to pin 3). A separate red LEG with 220 Ohm resistor connected to pin 5 and ground. A separate pushbutton connected to pin 1 and 3.3V power supply.
        </p>

        <p>
            <img src="final/final_schematic.jpg" width=400></a>
        </p>
        <p>
            I chose a 220 Ohm resistor for the red LED as calculated from Ohm's Law (R=V/I=(5-1.8)/0.025=128 Ohms). The joystick does not require external resistor as it is essentially two potentiometres. The pushbutton uses the Arduino pin's built-in pull-up resistor.
        </p>

        <p>
            <img src="final/final_operation.gif" width=400></a>
        </p>
        <p>
            By pressing the pushbutton, I turn on the Arduino's mouse control (the LED lights up as indicator) and use the Arduino as a regular mouse. Once I press the pushbutton again, the mouse is turned off and will no longer affect the computer cursor.
        </p>

        <p>
            Below is the Arduino code snippet:
        </p>
        <p>
            <pre>
                <font color="#95a5a6">&#47;*</font>
                <font color="#95a5a6"> &nbsp;This code is based on an example from the Arduino website.</font>
                <font color="#95a5a6"></font>
                <font color="#95a5a6"> &nbsp;</font><u><font color="#95a5a6">http:&#47;&#47;www.arduino.cc&#47;en&#47;Tutorial&#47;JoystickMouseControl</font></u><font color="#95a5a6"></font>
                <font color="#95a5a6">*&#47;</font>
                
                <font color="#5e6d03">#include</font> <font color="#005c5f">&#34;Mouse.h&#34;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; import Mouse library for Arduino Leonardo</font>
                
                <font color="#434f54">&#47;&#47; set pin numbers for switch, joystick axes, and LED:</font>
                <font color="#00979c">const</font> <font color="#00979c">int</font> <font color="#000000">switchPin</font> <font color="#434f54">=</font> <font color="#000000">2</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; switch to turn on and off mouse control</font>
                <font color="#00979c">const</font> <font color="#00979c">int</font> <font color="#000000">mouseButton</font> <font color="#434f54">=</font> <font color="#000000">3</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; input pin for the mouse pushButton</font>
                <font color="#00979c">const</font> <font color="#00979c">int</font> <font color="#000000">xAxis</font> <font color="#434f54">=</font> <font color="#000000">A0</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; joystick X axis</font>
                <font color="#00979c">const</font> <font color="#00979c">int</font> <font color="#000000">yAxis</font> <font color="#434f54">=</font> <font color="#000000">A1</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; joystick Y axis</font>
                <font color="#00979c">const</font> <font color="#00979c">int</font> <font color="#000000">ledPin</font> <font color="#434f54">=</font> <font color="#000000">5</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; Mouse control LED</font>
                
                <font color="#434f54">&#47;&#47; parameters for reading the joystick:</font>
                <font color="#00979c">int</font> <font color="#000000">range</font> <font color="#434f54">=</font> <font color="#000000">12</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; output range of X or Y movement</font>
                <font color="#00979c">int</font> <font color="#000000">responseDelay</font> <font color="#434f54">=</font> <font color="#000000">5</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; response delay of the mouse, in ms</font>
                <font color="#00979c">int</font> <font color="#000000">threshold</font> <font color="#434f54">=</font> <font color="#000000">range</font> <font color="#434f54">&#47;</font> <font color="#000000">4</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; resting threshold</font>
                <font color="#00979c">int</font> <font color="#000000">center</font> <font color="#434f54">=</font> <font color="#000000">range</font> <font color="#434f54">&#47;</font> <font color="#000000">2</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; resting position value</font>
                
                <font color="#00979c">bool</font> <font color="#000000">mouseIsActive</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font> &nbsp;&nbsp;<font color="#434f54">&#47;&#47; whether or not to control the mouse</font>
                <font color="#00979c">int</font> <font color="#000000">lastSwitchState</font> <font color="#434f54">=</font> <font color="#00979c">LOW</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; previous switch state</font>
                
                <font color="#434f54">&#47;&#47; setup code to run once:</font>
                <font color="#00979c">void</font> <font color="#5e6d03">setup</font><font color="#000000">(</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;<font color="#d35400">pinMode</font><font color="#000000">(</font><font color="#000000">switchPin</font><font color="#434f54">,</font> <font color="#00979c">INPUT_PULLUP</font><font color="#000000">)</font><font color="#000000">;</font><font color="#434f54">&#47;&#47; the switch pin</font>
                 &nbsp;<font color="#d35400">pinMode</font><font color="#000000">(</font><font color="#000000">ledPin</font><font color="#434f54">,</font> <font color="#00979c">OUTPUT</font><font color="#000000">)</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; the LED pin</font>
                 &nbsp;<b><font color="#d35400">Mouse</font></b><font color="#434f54">.</font><font color="#d35400">begin</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; take control of mouse</font>
                <font color="#000000">}</font>
                
                <font color="#434f54">&#47;&#47; main code to run repeatedly:</font>
                <font color="#00979c">void</font> <font color="#5e6d03">loop</font><font color="#000000">(</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;<font color="#434f54">&#47;&#47; read the switch:</font>
                 &nbsp;<font color="#00979c">int</font> <font color="#000000">switchState</font> <font color="#434f54">=</font> <font color="#d35400">digitalRead</font><font color="#000000">(</font><font color="#000000">switchPin</font><font color="#000000">)</font><font color="#000000">;</font>
                 &nbsp;<font color="#434f54">&#47;&#47; if it&#39;s changed and it&#39;s high, toggle the mouse state:</font>
                 &nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><font color="#000000">switchState</font> <font color="#434f54">!=</font> <font color="#000000">lastSwitchState</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><font color="#000000">switchState</font> <font color="#434f54">==</font> <font color="#00979c">HIGH</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">mouseIsActive</font> <font color="#434f54">=</font> <font color="#434f54">!</font><font color="#000000">mouseIsActive</font><font color="#000000">;</font>
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; turn on LED to indicate mouse state:</font>
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#d35400">digitalWrite</font><font color="#000000">(</font><font color="#000000">ledPin</font><font color="#434f54">,</font> <font color="#000000">mouseIsActive</font><font color="#000000">)</font><font color="#000000">;</font>
                 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
                 &nbsp;<font color="#000000">}</font>
                 &nbsp;<font color="#434f54">&#47;&#47; save switch state for next comparison:</font>
                 &nbsp;<font color="#000000">lastSwitchState</font> <font color="#434f54">=</font> <font color="#000000">switchState</font><font color="#000000">;</font>
                
                 &nbsp;<font color="#434f54">&#47;&#47; read and scale the two axes:</font>
                 &nbsp;<font color="#00979c">int</font> <font color="#000000">xReading</font> <font color="#434f54">=</font> <font color="#000000">readAxis</font><font color="#000000">(</font><font color="#000000">A0</font><font color="#000000">)</font><font color="#000000">;</font>
                 &nbsp;<font color="#00979c">int</font> <font color="#000000">yReading</font> <font color="#434f54">=</font> <font color="#000000">readAxis</font><font color="#000000">(</font><font color="#000000">A1</font><font color="#000000">)</font><font color="#000000">;</font>
                
                 &nbsp;<font color="#434f54">&#47;&#47; if the mouse control state is active, move the mouse:</font>
                 &nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><font color="#000000">mouseIsActive</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Mouse</font></b><font color="#434f54">.</font><font color="#d35400">move</font><font color="#000000">(</font><font color="#000000">xReading</font><font color="#434f54">,</font> <font color="#000000">yReading</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
                 &nbsp;<font color="#000000">}</font>
                
                 &nbsp;<font color="#434f54">&#47;&#47; read the mouse button and click or not click:</font>
                 &nbsp;<font color="#434f54">&#47;&#47; if the mouse button is pressed:</font>
                 &nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><font color="#d35400">digitalRead</font><font color="#000000">(</font><font color="#000000">mouseButton</font><font color="#000000">)</font> <font color="#434f54">==</font> <font color="#00979c">HIGH</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; if the mouse is not pressed, press it:</font>
                 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><font color="#434f54">!</font><b><font color="#d35400">Mouse</font></b><font color="#434f54">.</font><font color="#d35400">isPressed</font><font color="#000000">(</font><font color="#000000">MOUSE_LEFT</font><font color="#000000">)</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><font color="#d35400">Mouse</font></b><font color="#434f54">.</font><font color="#d35400">press</font><font color="#000000">(</font><font color="#000000">MOUSE_LEFT</font><font color="#000000">)</font><font color="#000000">;</font>
                 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
                 &nbsp;<font color="#000000">}</font>
                 &nbsp;<font color="#434f54">&#47;&#47; else the mouse button is not pressed:</font>
                 &nbsp;<font color="#5e6d03">else</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; if the mouse is pressed, release it:</font>
                 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><b><font color="#d35400">Mouse</font></b><font color="#434f54">.</font><font color="#d35400">isPressed</font><font color="#000000">(</font><font color="#000000">MOUSE_LEFT</font><font color="#000000">)</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><font color="#d35400">Mouse</font></b><font color="#434f54">.</font><font color="#d35400">release</font><font color="#000000">(</font><font color="#000000">MOUSE_LEFT</font><font color="#000000">)</font><font color="#000000">;</font>
                 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
                 &nbsp;<font color="#000000">}</font>
                
                 &nbsp;<font color="#d35400">delay</font><font color="#000000">(</font><font color="#000000">responseDelay</font><font color="#000000">)</font><font color="#000000">;</font>
                <font color="#000000">}</font>
                
                
                <font color="#434f54">&#47;&#47; reads an axis (0 or 1 for x or y) and scales the analog input range to a range from 0 to &lt;range&gt;:</font>
                <font color="#00979c">int</font> <font color="#000000">readAxis</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">thisAxis</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;<font color="#434f54">&#47;&#47; read the analog input:</font>
                 &nbsp;<font color="#00979c">int</font> <font color="#000000">reading</font> <font color="#434f54">=</font> <font color="#d35400">analogRead</font><font color="#000000">(</font><font color="#000000">thisAxis</font><font color="#000000">)</font><font color="#000000">;</font>
                
                 &nbsp;<font color="#434f54">&#47;&#47; map the reading from the analog input range to the output range:</font>
                 &nbsp;<font color="#000000">reading</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">reading</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">1023</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">range</font><font color="#000000">)</font><font color="#000000">;</font>
                
                 &nbsp;<font color="#434f54">&#47;&#47; if the output reading is outside from the rest position threshold, use it:</font>
                 &nbsp;<font color="#00979c">int</font> <font color="#000000">distance</font> <font color="#434f54">=</font> <font color="#000000">reading</font> <font color="#434f54">-</font> <font color="#000000">center</font><font color="#000000">;</font>
                
                 &nbsp;<font color="#5e6d03">if</font> <font color="#000000">(</font><font color="#d35400">abs</font><font color="#000000">(</font><font color="#000000">distance</font><font color="#000000">)</font> <font color="#434f54">&lt;</font> <font color="#000000">threshold</font><font color="#000000">)</font> <font color="#000000">{</font>
                 &nbsp;&nbsp;&nbsp;<font color="#000000">distance</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
                 &nbsp;<font color="#000000">}</font>
                
                 &nbsp;<font color="#434f54">&#47;&#47; return the distance for this axis:</font>
                 &nbsp;<font color="#5e6d03">return</font> <font color="#000000">distance</font><font color="#000000">;</font>
                <font color="#000000">}</font>
                
                </pre>
        </p>
    </div>

</body>

</html>